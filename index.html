<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Taylor Swift Song Sorter</title>
<link href='https://fonts.googleapis.com/css?family=Josefin+Slab:600' rel='stylesheet'>

<script>
// ---------------------------------------------
//  SONG LIST
// ---------------------------------------------
var namMember = [
    "...Ready for it?",
    "22",
    "Actually Romantic",
    "Afterglow",
    "All Of The Girls You Loved Before",
    "All Too Well",
    "All Too Well (10 minute version)",
    "All You Had To Do Was Stay",
    "Anti Hero (feat. Bleachers)",
    "Anti-Hero",
    "august",
    "Babe",
    "Back To December",
    "Bad Blood",
    "Bad Blood (ft. Kendrick Lamar)",
    "Beautiful Eyes",
    "Beautiful Ghosts",
    "Begin Again",
    "Bejeweled",
    "Better Man",
    "Better Than Revenge",
    "betty",
    "Bigger Than The Whole Sky",
    "Blank Space",
    "Breathe",
    "But Daddy I Love Him",
    "Bye Bye Baby",
    "Call It What You Want",
    "CANCELLED!",
    "cardigan",
    "Carolina",
    "Cassandra",
    "Castles Crumbling",
    "champagne problems",
    "Change",
    "Chloe or Sam or Sophia or Marcus",
    "Christmas Tree Farm",
    "Clara Bow",
    "Clean",
    "closure",
    "Cold As You",
    "Come Back...Be Here",
    "Come In With The Rain",
    "coney island (feat. The National)",
    "Cornelia Street",
    "cowboy like me",
    "Crazier",
    "Cruel Summer",
    "Dancing With Our Hands Tied",
    "Daylight",
    "Dear John",
    "Dear Reader",
    "Death By a Thousand Cuts",
    "Delicate",
    "Don't Blame Me",
    "Don't You",
    "dorothea",
    "Down Bad",
    "Dress",
    "Electric Touch",
    "Eldest Daughter",
    "Elizabeth Taylor",
    "Enchanted",
    "End Game",
    "epiphany",
    "evermore (feat. Bon Iver)",
    "Everything Has Changed",
    "exile(featuring Bon Iver)",
    "Eyes Open",
    "False God",
    "Father Figure",
    "Fearless",
    "Fifteen",
    "Florida!!! (Ft. Florence + the Machine)",
    "Foolish One",
    "Forever and Always",
    "Forever and Always (Piano Version)",
    "Forever Winter",
    "Fortnight (Ft. Post Malone)",
    "Fresh out The Slammer",
    "Getaway Car",
    "Girl at Home",
    "Glitch",
    "gold rush",
    "Gorgeous",
    "Guilty as Sin?",
    "happiness",
    "Haunted",
    "Hey Stephen",
    "High Infidelity",
    "Hits Different",
    "hoax",
    "Holy Ground",
    "Honey",
    "How Did It End?",
    "How You Get The Girl",
    "I Almost Do",
    "I Bet You Think About Me",
    "I Can Do It With a Broken Heart",
    "I Can Fix Him (No Really I Can)",
    "I Can See You",
    "I Did Something Bad",
    "I Don't Wanna Live Forever",
    "I Forgot That You Existed",
    "I Hate It Here",
    "I Heart ?",
    "I Know Places",
    "I Knew You Were Trouble",
    "I Look in People's Windows",
    "I Think He Knows",
    "I Wish You Would",
    "I'd Lie",
    "I'm Only Me When I'm With You",
    "If This Was A Movie",
    "illicit affairs",
    "imgonnagetyouback",
    "Innocent",
    "invisible string",
    "Invisible",
    "Is it Over Now?",
    "It's Nice to Have a Friend",
    "it's time to go (bonus track)",
    "ivy",
    "Jump Then Fall",
    "Karma",
    "Karma (Ft. IceSpice)",
    "King Of My Heart",
    "Labyrinth",
    "Last Kiss",
    "Lavender Haze",
    "loml",
    "London Boy",
    "Long Live",
    "long story short",
    "Love Story",
    "Lover",
    "LWYMMD",
    "mad woman",
    "marjorie",
    "Maroon",
    "Mary's Song (Oh My My My)",
    "Mastermind",
    "ME!",
    "Mean",
    "Message in A Bottle",
    "Midnight Rain",
    "Mine",
    "mirrorball",
    "Miss Americana & the Heartbreak Prince",
    "Mr. Perfectly Fine",
    "My Boy Only Breaks His Favourite Toys",
    "my tears ricochet",
    "Never Grow Up",
    "New Romantics",
    "New Years Day",
    "no body, no crime (feat. Haim)",
    "Nothing New",
    "Now That We Don't Talk",
    "Opalite",
    "Our Song",
    "Ours",
    "Out of the Woods",
    "Paper Rings",
    "Paris",
    "peace",
    "Peter",
    "A Perfectly Good Heart",
    "Picture To Burn",
    "A Place in This World",
    "Question...?",
    "Red",
    "Renegade",
    "right where you left me (bonus track)",
    "Robin",
    "Ruin the Friendship",
    "Run",
    "Sad Beautiful Tragic",
    "Safe & Sound",
    "Say Dont Go",
    "seven",
    "Shake it Off",
    "Should've Said No",
    "Slut!",
    "Snow on the Beach ft. Lana Del Rey",
    "Snow on the Beach ft. More Lana Del Rey",
    "So High School",
    "So It Goes..",
    "So Long, London",
    "Soon You'll Get Better (feat. Dixie Chicks)",
    "Sparks Fly",
    "Speak Now",
    "Starlight",
    "State of Grace",
    "State of Grace (acoustic)",
    "Stay Beautiful",
    "Stay Stay Stay",
    "Style",
    "Suburban Legends",
    "Superman",
    "Superstar",
    "Sweet Nothing",
    "Sweeter than Fiction",
    "Teardrops on My Guitar",
    "Tell Me Why",
    "thanK you alMee",
    "That's When (Ft. Keith Urban)",
    "the 1",
    "The Alchemy",
    "The Albatross",
    "The Alcott (feat. Taylor Swift)",
    "The Archer",
    "The Best Day",
    "The Black Dog",
    "The Bolter",
    "The Fate of Ophelia",
    "The Great War",
    "the lakes",
    "the last great american dynasty",
    "The Last Time",
    "The Life of A Show Girl (Ft. Sabrina Carpenter)",
    "The Lucky One",
    "The Man",
    "The Manuscript",
    "The Moment I Knew",
    "The Other Side of the Door",
    "The Outside",
    "The Prophecy",
    "The Smallest Man Who Ever Lived",
    "The Story of Us",
    "The Tortured Poets Department",
    "The Very First Night",
    "The Way I Loved You",
    "Thug Story",
    "this is me trying",
    "This Is Why We Can't Have Nice Things",
    "This Love",
    "Tied Together with a Smile",
    "Tim McGraw",
    "Timeless",
    "tolerate it",
    "'tis the damn season",
    "Today Was a Fairytale",
    "Treacherous",
    "Untouchable",
    "Vigilante Shit",
    "We Are Never Ever Getting Back Together",
    "We Were Happy",
    "Welcome to New York",
    "When Emma Falls in Love",
    "White Horse",
    "Who's Afraid of Lil Old Me?",
    "Wi$h Li$t",
    "Wildest Dreams",
    "willow",
    "Wood",
    "Wonderland",
    "Would've, Could've, Should've",
    "You All Over Me",
    "You Are in Love",
    "You Belong With Me",
    "You Need To Calm Down",
    "You're Losing Me",
    "You're Not Sorry",
    "You're on Your Own, Kid",
    "Only The Young"
];

// ------------------------------------------------
// GLOBALS
// ------------------------------------------------
var mergeQueue = [];
var lstMember = [];
var rec = [];
var equal = [];
var head1, head2;
var cmp1, cmp2;
var finishFlag = 0;
var numQuestion = 1;
var finishSize = 0;
var totalSize = 0;

// ---------------------------------------------
//  REAL FIX: BUILD A MERGE QUEUE
// ---------------------------------------------
function initList() {
    mergeQueue = [];
    lstMember = [];
    rec = [];
    equal = [];

    // fill arrays
    for (let i = 0; i < namMember.length; i++) {
        rec[i] = 0;
        equal[i] = -1;
    }

    // shuffle
    let base = [];
    for (let i = 0; i < namMember.length; i++) base[i] = i;

    // deterministic shuffle
    for (let i = base.length - 1; i > 0; i--) {
        let r = Math.floor(Math.random() * (i + 1));
        [base[i], base[r]] = [base[r], base[i]];
    }

    // build a perfect binary split tree
    lstMember.push(base);

    let queue = [0];

    while (queue.length) {
        let idx = queue.shift();
        let arr = lstMember[idx];

        if (arr.length <= 1) continue;

        let mid = Math.ceil(arr.length / 2);

        let left = lstMember.length;
        lstMember.push(arr.slice(0, mid));

        let right = lstMember.length;
        lstMember.push(arr.slice(mid));

        // enqueue children
        queue.push(left);
        queue.push(right);

        // add to merge queue (child1, child2, parent)
        mergeQueue.push([left, right, idx]);

        totalSize += arr.length;
    }

    // start with last merge pair
    mergeQueue = mergeQueue.reverse();

    let first = mergeQueue[0];
    cmp1 = first[0];
    cmp2 = first[1];
    head1 = 0;
    head2 = 0;

    numQuestion = 1;
    finishSize = 0;
    finishFlag = 0;
}

// ---------------------------------------------
//  COMPARISON LOGIC
// ---------------------------------------------
function sortList(flag) {
    let arr1 = lstMember[cmp1];
    let arr2 = lstMember[cmp2];

    if (flag < 0) {
        rec.push(arr1[head1]);
        head1++;
    } else if (flag > 0) {
        rec.push(arr2[head2]);
        head2++;
    } else {
        rec.push(arr1[head1]);
        head1++;
        rec.push(arr2[head2]);
        head2++;
        equal[rec[rec.length - 2]] = rec[rec.length - 1];
    }

    finishSize++;

    // if one side ends, flush the other
    if (head1 >= arr1.length && head2 < arr2.length) {
        while (head2 < arr2.length) {
            rec.push(arr2[head2++]);
            finishSize++;
        }
    }
    if (head2 >= arr2.length && head1 < arr1.length) {
        while (head1 < arr1.length) {
            rec.push(arr1[head1++]);
            finishSize++;
        }
    }

    // when both lists are consumed
    if (head1 >= arr1.length && head2 >= arr2.length) {
        // write merged result into parent
        let parent = mergeQueue[0][2];
        lstMember[parent] = rec.slice();

        // reset rec
        rec = [];

        // move to next merge pair
        mergeQueue.shift();

        if (mergeQueue.length === 0) {
            finishFlag = 1;
            showResult();
            return;
        }

        let next = mergeQueue[0];
        cmp1 = next[0];
        cmp2 = next[1];
        head1 = 0;
        head2 = 0;
    }

    showImage();
}

// ---------------------------------------------
//  DISPLAY
// ---------------------------------------------
function toNameFace(n) {
    return "<div style='padding:10px;'>" + namMember[n] + "</div>";
}

function showImage() {
    document.getElementById("battleNumber").innerHTML =
        "Battle #" + numQuestion + "<br>" +
        Math.floor(finishSize * 100 / totalSize) + "% sorted.";

    document.getElementById("leftField").innerHTML =
        toNameFace(lstMember[cmp1][head1]);
    document.getElementById("rightField").innerHTML =
        toNameFace(lstMember[cmp2][head2]);

    numQuestion++;
}

// ---------------------------------------------
//  RESULTS
// ---------------------------------------------
function showResult() {
    let final = lstMember[0];

    let html = "<table style='width:400px;font-size:18px;border:1px solid #000;border-collapse:collapse;margin:auto'>";
    html += "<tr><td style='background:#000;color:#fff;text-align:center'>Rank</td>";
    html += "<td style='background:#000;color:#fff;text-align:center'>Song</td></tr>";

    let rank = 1;

    for (let i = 0; i < final.length; i++) {
        let song = namMember[final[i]];

        html += "<tr><td style='border:1px solid #000;text-align:center'>" + rank +
            "</td><td style='border:1px solid #000;padding-left:5px'>" +
            song + "</td></tr>";

        if (i < final.length - 1 &&
            equal[final[i]] !== final[i + 1]) {
            rank++;
        }
    }

    html += "</table>";

    document.getElementById("resultField").innerHTML = html;
}

// ---------------------------------------------
window.onload = function() {
    initList();
    showImage();
};
</script>

<style>
body { width: 600px; margin: 0 auto; font-family: 'Josefin Slab', serif; }
#mainTable { font-size:19px; width:410px; margin:auto; border-spacing:10px 5px; }
#leftField, #rightField, .middleField {
    border:1px solid #000; cursor:pointer; text-align:center;
}
#leftField, #rightField { width:120px; height:150px; }
.middleField { width:120px; height:70px; }
.button {
    background:#5b17ba; color:white; padding:10px 20px; border:0;
    margin:5px; border-radius:5px; cursor:pointer; font-size:16px;
}
.button:hover { background:#945ce3; }
</style>

</head>
<body>

<center><br><br><b>Taylor Swift Song Sorter</b><br><br></center>

<table id="mainTable">
    <tr><td id="battleNumber" colspan="3" style="text-align:center;"><b>Battle #1<br>0% sorted</b></td></tr>
    <tr>
        <td id="leftField" onclick="if(!finishFlag) sortList(-1)"></td>
        <td class="middleField" onclick="if(!finishFlag) sortList(0)">I Like Both</td>
        <td id="rightField" onclick="if(!finishFlag) sortList(1)"></td>
    </tr>
    <tr><td></td><td class="middleField" onclick="if(!finishFlag) sortList(0)">No Opinion</td><td></td></tr>
</table>

<br><br>
<div id="resultField" style="text-align:center;"></div>

</body>
</html>
